version: '3.8'

services:
  # 1. The Brain (API + Simulator + Walker)
  snmp-backend:
    build: ./backend
    container_name: snmp-studio-backend
    ports:
      - "8000:8000"      # API Access
      - "${SNMP_PORT:-1061}:${SNMP_PORT:-1061}/udp"  # Simulator UDP Port (configurable)
      - "${TRAP_PORT:-1162}:${TRAP_PORT:-1162}/udp"  # Trap Receiver Port (configurable)
    volumes:
      # Mount the data folder for persistence
      - ./backend/data:/app/data
      # Mount MIBs specifically to where Net-SNMP expects them
      - ./backend/data/mibs:/usr/share/snmp/mibs/custom
    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - SNMP_PORT=${SNMP_PORT:-1061}
      - SNMP_COMMUNITY=${SNMP_COMMUNITY:-public}
      - TRAP_PORT=${TRAP_PORT:-1162}
      - APP_NAME=${APP_NAME:-SNMP Studio}
      - SESSION_TIMEOUT=${SESSION_TIMEOUT:-3600}
    restart: always

  # 2. The Face (Web UI)
  snmp-frontend:
    build: ./frontend
    container_name: snmp-studio-frontend
    ports:
      - "8080:80"
    depends_on:
      - snmp-backend
    restart: always
